<!DOCTYPE html><html><head><meta name="author" content="Óscar Miranda"/><meta name="keywords" content="portfolio, resume, blog, react, nextjs, web, development"/><meta property="og:image" content="https://avatars.githubusercontent.com/u/60676993?v=4"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="description" content="
Create the useLocalStorage custom hook.

"/><title>Build your own React hook - Blog | Óscar Miranda</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/6231aefe3b5e4403.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6231aefe3b5e4403.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-a56127814584ab09.js" defer=""></script><script src="/_next/static/chunks/pages/_app-80ee506542e4f1c5.js" defer=""></script><script src="/_next/static/chunks/597-5ac864b7e1feb084.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-f0a2d95d9747f481.js" defer=""></script><script src="/_next/static/qVoY7j4a8gA0N0HtrkynY/_buildManifest.js" defer=""></script><script src="/_next/static/qVoY7j4a8gA0N0HtrkynY/_ssgManifest.js" defer=""></script><script src="/_next/static/qVoY7j4a8gA0N0HtrkynY/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><nav class="navbar navbar-expand-lg navbar-dark bg-primary"><div class="container-fluid"><a href="/" class="navbar-brand">Óscar Miranda</a><button type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse"><div class="ms-auto navbar-nav"><a href="/" data-rr-ui-event-key="/" class="nav-link">About</a><a href="/resume" data-rr-ui-event-key="/resume" class="nav-link">Resume</a><a href="/portfolio" data-rr-ui-event-key="/portfolio" class="nav-link">Portfolio</a><a href="/blog" data-rr-ui-event-key="/blog" class="active nav-link">Blog</a><a href="/contact" data-rr-ui-event-key="/contact" class="nav-link">Contact</a></div></div></div></nav><div class="container-fluid"><div class="row my-4"><div class="col col-12 col-lg-8 mb-4 mb-lg-0"><div class="card"><div class="card-body"><section><article class="p-4"><header class="post-header mb-4"><h3>Build your own React hook</h3><small class="text-muted">Written on <!-- -->June 30, 2021</small></header><div class="post-content"><p>Create the useLocalStorage custom hook.</p>
<hr>
<p>React hooks are useful to extract component logic and convert it into a reusable
function to share logic between components.</p>
<h3 id="how-to-create-a-hook">How to create a hook</h3>
<ul>
<li>Hooks name must start with <code>use</code></li>
<li>They can call another hooks</li>
<li>Have any arguments and return any value</li>
</ul>
<h3 id="example-uselocalstorage">Example: useLocalStorage</h3>
<p>Define the hook name by creating a new function, it will receive the key and the
initial value:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">useLocalStorage</span> = (<span class="hljs-params">key, initialValue</span>) =&gt; {}
</code></pre>
<p>Current value can be managed by `useState`, so we need to import it:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">useLocalStorage</span> = (<span class="hljs-params">key, initialValue</span>) =&gt; {
  <span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>();
}
</code></pre>
<p>We need to get the value from localStorage, so we will pass a function to
<code>useState</code> (<code>useState</code> can receive a function):</p>
<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">useLocalStorage</span> = (<span class="hljs-params">key, initialValue</span>) =&gt; {
  <span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> item = <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">getItem</span>(key);
      <span class="hljs-keyword">return</span> item ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(item) : initialValue;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">return</span> initialValue;
    }
  });

  <span class="hljs-keyword">return</span> state;
</code></pre>
<p>With this, we are trying to get value from localStorage if it exists, if not,
then use the initial value.</p>
<p><em>If the value stored in localStorage is invalid, then use the initial value.</em></p>
<p>We need to return some way to update the value returned, so we can return a
closure function:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">useLocalStorage</span> = (<span class="hljs-params">key, initialValue</span>) =&gt; {
  <span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> item = <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">getItem</span>(key);
      <span class="hljs-keyword">return</span> item ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(item) : initialValue;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">return</span> initialValue;
    }
  });

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setNewState</span> = (<span class="hljs-params">newValue</span>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-title function_">setState</span>(newValue);
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">setItem</span>(key, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(newValue));
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
    }
  }

  <span class="hljs-keyword">return</span> [state, setNewState];
</code></pre>
<p>Note that we are <em>stringifying</em> the new value before storing it because
localStorage only allows strings as values and we want our function to store any
object.</p>
<p>Also we are returning an array with the current value and the setter function
like <code>useState</code> does.</p>
<p>Finally, we export the hook to import it from any component.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useLocalStorage;
</code></pre>
<h4 id="typescript-version">Typescript version</h4>
<p>If you are working on a Typescript React project, you can do the following
changes to ensure typing:</p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;

<span class="hljs-keyword">const</span> useLocalStorage = &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">key: <span class="hljs-built_in">string</span>, initialValue: T</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> [state, setState] = useState&lt;T&gt;(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> item = <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">getItem</span>(key);
      <span class="hljs-keyword">return</span> item ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(item) : initialValue;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">return</span> initialValue;
    }
  });

  <span class="hljs-keyword">const</span> setNewState = (<span class="hljs-attr">newValue</span>: T): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-title function_">setState</span>(newValue);
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">setItem</span>(key, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(newValue));
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
    }
  }

  <span class="hljs-keyword">return</span> [state, setNewState] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useLocalStorage;
</code></pre>
<p>This ensures we pass always a value of the same type when passing the initial
value and when passing a new value.</p>
</div><footer class="post-footer pt-2"><hr/>Tagged in: <!-- -->react, typescript</footer></article></section></div></div></div><div class="col col-12 col-lg-4"><div class="card mb-4"><div class="card-body"><h3>Github Stats</h3><div class="d-flex flex-wrap gap-2"><img class="img-fluid h-100" src="https://github-readme-stats.vercel.app/api?username=OscarM3615&amp;show_icons=true&amp;hide_rank=true&amp;title_color=07689f&amp;icon_color=07689f&amp;hide_border=true" alt="OscarM3615&#x27;s Github Stats"/><img class="img-fluid h-100" src="https://github-readme-stats.vercel.app/api/top-langs?username=OscarM3615&amp;hide=html&amp;layout=compact&amp;title_color=07689f&amp;hide_border=true" alt="Most Used Languages"/></div></div></div><div class="card"><div class="card-body"><div class="flex-center">Website created by Óscar Miranda using<!-- --> <a href="https://nextjs.org/" target="_blank" rel="noreferrer">Next.js</a> <!-- -->and<!-- --> <a href="https://getbootstrap.com/" target="_blank" rel="noreferrer">Bootstrap</a>.</div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"build-your-own-react-hook","title":"Build your own React hook","description":"\nCreate the useLocalStorage custom hook.\n\n","createdAt":"June 30, 2021","tags":["react","typescript"],"content":"\nCreate the useLocalStorage custom hook.\n\n---\n\nReact hooks are useful to extract component logic and convert it into a reusable\nfunction to share logic between components.\n\n### How to create a hook\n\n- Hooks name must start with `use`\n- They can call another hooks\n- Have any arguments and return any value\n\n### Example: useLocalStorage\n\nDefine the hook name by creating a new function, it will receive the key and the\ninitial value:\n\n```javascript\nconst useLocalStorage = (key, initialValue) =\u003e {}\n```\n\nCurrent value can be managed by \\`useState\\`, so we need to import it:\n\n```javascript\nimport { useState } from 'react';\n\nconst useLocalStorage = (key, initialValue) =\u003e {\n  const [state, setState] = useState();\n}\n```\n\nWe need to get the value from localStorage, so we will pass a function to\n`useState` (`useState` can receive a function):\n\n```javascript\nimport { useState } from 'react';\n\nconst useLocalStorage = (key, initialValue) =\u003e {\n  const [state, setState] = useState(() =\u003e {\n    try {\n      const item = window.localStorage.getItem(key);\n      return item ? JSON.parse(item) : initialValue;\n    } catch (error) {\n      return initialValue;\n    }\n  });\n\n  return state;\n```\n\nWith this, we are trying to get value from localStorage if it exists, if not,\nthen use the initial value.\n\n_If the value stored in localStorage is invalid, then use the initial value._\n\nWe need to return some way to update the value returned, so we can return a\nclosure function:\n\n```javascript\nimport { useState } from 'react';\n\nconst useLocalStorage = (key, initialValue) =\u003e {\n  const [state, setState] = useState(() =\u003e {\n    try {\n      const item = window.localStorage.getItem(key);\n      return item ? JSON.parse(item) : initialValue;\n    } catch (error) {\n      return initialValue;\n    }\n  });\n\n  const setNewState = (newValue) =\u003e {\n    try {\n      setState(newValue);\n      window.localStorage.setItem(key, JSON.stringify(newValue));\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  return [state, setNewState];\n```\n\nNote that we are _stringifying_ the new value before storing it because\nlocalStorage only allows strings as values and we want our function to store any\nobject.\n\nAlso we are returning an array with the current value and the setter function\nlike `useState` does.\n\nFinally, we export the hook to import it from any component.\n\n```javascript\nexport default useLocalStorage;\n```\n\n#### Typescript version\n\nIf you are working on a Typescript React project, you can do the following\nchanges to ensure typing:\n\n```typescript\nimport { useState } from 'react';\n\nconst useLocalStorage = \u003cT\u003e(key: string, initialValue: T) =\u003e {\n  const [state, setState] = useState\u003cT\u003e(() =\u003e {\n    try {\n      const item = window.localStorage.getItem(key);\n      return item ? JSON.parse(item) : initialValue;\n    } catch (error) {\n      return initialValue;\n    }\n  });\n\n  const setNewState = (newValue: T): void =\u003e {\n    try {\n      setState(newValue);\n      window.localStorage.setItem(key, JSON.stringify(newValue));\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  return [state, setNewState] as const;\n}\n\nexport default useLocalStorage;\n```\n\nThis ensures we pass always a value of the same type when passing the initial\nvalue and when passing a new value.\n"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"build-your-own-react-hook"},"buildId":"qVoY7j4a8gA0N0HtrkynY","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>